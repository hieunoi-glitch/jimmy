<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡—æ­©ãã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f0f0f0; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 400px; margin: 0 auto; }
        .stamp { 
            background: white; border: 3px dashed #ccc; border-radius: 15px; 
            padding: 20px 10px; font-weight: bold; color: #ccc; transition: 0.3s;
        }
        /* ã‚¹ã‚¿ãƒ³ãƒ—ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã®è¦‹ãŸç›® */
        .stamp.active { 
            border: 3px solid #ff6b6b; color: #ff6b6b; background: #fff5f5;
            opacity: 1; transform: scale(1.05);
        }
        #message { margin-top: 20px; color: #d63031; font-weight: bold; min-height: 1.5em; }
        .congrats { display: none; background: gold; padding: 10px; margin-top: 20px; border-radius: 10px; }
    </style>
</head>
<body>

    <h1>è¡—æ­©ãã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h1>
    <p>è¡—ã«éš ã•ã‚ŒãŸQRã‚³ãƒ¼ãƒ‰ã‚’æ¢ãã†ï¼</p>

    <div class="grid">
        <div id="s1" class="stamp">ã‚¹ãƒãƒƒãƒˆ1</div>
        <div id="s2" class="stamp">ã‚¹ãƒãƒƒãƒˆ2</div>
        <div id="s3" class="stamp">ã‚¹ãƒãƒƒãƒˆ3</div>
        <div id="s4" class="stamp">ã‚¹ãƒãƒƒãƒˆ4</div>
        <div id="s5" class="stamp">ã‚¹ãƒãƒƒãƒˆ5</div>
        <div id="s6" class="stamp">ã‚¹ãƒãƒƒãƒˆ6</div>
        <div id="s7" class="stamp">ã‚¹ãƒãƒƒãƒˆ7</div>
        <div id="s8" class="stamp">ã‚¹ãƒãƒƒãƒˆ8</div>
    </div>

    <div id="message"></div>

    <div id="congrats-msg" class="congrats">
        ğŸ‰ å…¨ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼ãŠã‚ã§ã¨ã†ï¼ ğŸ‰<br>
        ã“ã®ç”»é¢ã‚’ã‚¹ã‚¿ãƒƒãƒ•ã«è¦‹ã›ã¦ã­ã€‚
    </div>

    <script>
        // --- è¨­å®š ---
        const totalSpots = 8; // å…¨éƒ¨ã§ä½•ç®‡æ‰€ã‹

        // 1. URLã®ã€Œ?id=æ•°å­—ã€ã‚’èª­ã¿å–ã‚‹ (Rã®å¤‰æ•°å–å¾—ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸)
        const params = new URLSearchParams(window.location.search);
        const getID = params.get('id');

        // 2. ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚¿ãƒ³ãƒ—å¸³ã‚’èª­ã¿å‡ºã™
        let myStamps = JSON.parse(localStorage.getItem('my_rally_data')) || [];

        // 3. ã‚‚ã—æ–°ã—ã„IDã‚’èª­ã¿è¾¼ã‚“ã ã‚‰ã€ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¦ä¿å­˜
        if (getID && !myStamps.includes(getID)) {
            myStamps.push(getID);
            localStorage.setItem('my_rally_data', JSON.stringify(myStamps));
            document.getElementById('message').innerText = "æ–°ã—ã„ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆï¼";
        } else if (getID) {
            document.getElementById('message').innerText = "ã“ã®ã‚¹ã‚¿ãƒ³ãƒ—ã¯å–å¾—æ¸ˆã¿ã§ã™";
        }

        // 4. ç”»é¢ã‚’æ›´æ–°ï¼ˆå–å¾—æ¸ˆã¿ã‚’èµ¤ãã™ã‚‹ï¼‰
        myStamps.forEach(id => {
            const target = document.getElementById('s' + id);
            if (target) target.classList.add('active');
        });

        // 5. å…¨éƒ¨æƒã£ãŸã‹ãƒã‚§ãƒƒã‚¯
        if (myStamps.length >= totalSpots) {
            document.getElementById('congrats-msg').style.display = 'block';
        }
    </script>
</body>
</html>
